<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>自建存储 | 付之轻 - 帮助文档</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/assets/images/logo.jpg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon/apple-icon-152x152-dunplab-manifest-9822.jpg">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="付之轻网络工作室出品的WordPress插件、主题的在线文档">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icon/apple-icon-144x144-dunplab-manifest-9822.jpg">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.3ac08e06.css" as="style"><link rel="preload" href="/assets/js/app.3daa5b21.js" as="script"><link rel="preload" href="/assets/js/2.4e835e48.js" as="script"><link rel="preload" href="/assets/js/14.6b41597e.js" as="script"><link rel="preload" href="/assets/js/3.050f3734.js" as="script"><link rel="prefetch" href="/assets/js/10.d983aed8.js"><link rel="prefetch" href="/assets/js/11.c56d7c80.js"><link rel="prefetch" href="/assets/js/12.1958c88f.js"><link rel="prefetch" href="/assets/js/13.f0312e9e.js"><link rel="prefetch" href="/assets/js/15.40ab5a27.js"><link rel="prefetch" href="/assets/js/16.93166b1e.js"><link rel="prefetch" href="/assets/js/17.8963ccf1.js"><link rel="prefetch" href="/assets/js/18.2f01d8c5.js"><link rel="prefetch" href="/assets/js/4.1716ad21.js"><link rel="prefetch" href="/assets/js/5.787ba1cf.js"><link rel="prefetch" href="/assets/js/6.ea343eb1.js"><link rel="prefetch" href="/assets/js/7.f93f9957.js"><link rel="prefetch" href="/assets/js/8.47160608.js"><link rel="prefetch" href="/assets/js/9.0adfc5bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3ac08e06.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/images/logo.jpg" alt="付之轻 - 帮助文档" class="logo"> <span class="site-name can-hide">付之轻 - 帮助文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="附件管理插件" class="dropdown-title"><span class="title">附件管理插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/" class="nav-link router-link-active">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/getting-started/" class="nav-link">
  快速上手
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/self-built-storage/" class="nav-link">
  自建存储
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/theme/" class="nav-link">
  适配主题
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/template/" class="nav-link">
  自定义模板
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/download/" class="nav-link">
  下载地址
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/how-to-update/" class="nav-link">
  插件升级
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/question-and-answer/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/files-migration/" class="nav-link">
  附件迁移
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/change-log/" class="nav-link">
  更新日志
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="标签页插件" class="dropdown-title"><span class="title">标签页插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fuzqing-tags-page/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-tags-page/#下载地址" class="nav-link">
  下载地址
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="附件管理插件" class="dropdown-title"><span class="title">附件管理插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/" class="nav-link router-link-active">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/getting-started/" class="nav-link">
  快速上手
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/self-built-storage/" class="nav-link">
  自建存储
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/theme/" class="nav-link">
  适配主题
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/template/" class="nav-link">
  自定义模板
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/download/" class="nav-link">
  下载地址
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/how-to-update/" class="nav-link">
  插件升级
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/question-and-answer/" class="nav-link">
  常见问题
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/files-migration/" class="nav-link">
  附件迁移
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-file-manager/change-log/" class="nav-link">
  更新日志
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="标签页插件" class="dropdown-title"><span class="title">标签页插件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fuzqing-tags-page/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/fuzqing-tags-page/#下载地址" class="nav-link">
  下载地址
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>付之轻附件管理插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fuzqing-file-manager/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/fuzqing-file-manager/getting-started.html" class="sidebar-link">快速上手</a></li><li><a href="/fuzqing-file-manager/self-built-storage.html" aria-current="page" class="active sidebar-link">自建存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fuzqing-file-manager/self-built-storage.html#服务端配置" class="sidebar-link">服务端配置</a></li><li class="sidebar-sub-header"><a href="/fuzqing-file-manager/self-built-storage.html#插件配置项" class="sidebar-link">插件配置项</a></li></ul></li><li><a href="/fuzqing-file-manager/theme.html" class="sidebar-link">适配主题</a></li><li><a href="/fuzqing-file-manager/template.html" class="sidebar-link">自定义模板</a></li><li><a href="/fuzqing-file-manager/download.html" class="sidebar-link">下载地址</a></li><li><a href="/fuzqing-file-manager/how-to-update.html" class="sidebar-link">插件升级</a></li><li><a href="/fuzqing-file-manager/question-and-answer.html" class="sidebar-link">常见问题</a></li><li><a href="/fuzqing-file-manager/files-migration.html" class="sidebar-link">附件迁移</a></li><li><a href="/fuzqing-file-manager/change-log.html" class="sidebar-link">更新日志</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="自建存储"><a href="#自建存储" class="header-anchor">#</a> 自建存储</h1> <p>自建存储服务端代码下载地址：<a href="https://objectstorage.ap-seoul-1.oraclecloud.com/p/6t6bHNfSm00sHjSR3ExJ1HMHCS63HRH3XXiWLuRJKjY/n/cnpi5kfyrcan/b/bucket-20200801-1628/o/fuzqing-file-manager-self-built-storage-v0.1.zip" target="_blank" rel="noopener noreferrer">0.1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>如果客户端网站（安装<code>WordPress</code>的网站）使用了<code>https</code>，那么自建存储服务端也必须开启<code>https</code></p> <p>PHP 函数 “exec” 需要开启后才能正常使用自建存储服务端的代码</p> <p>如果你的博客和自建存储服务不在同一台服务器上面，那么你需要进行两次把禁用函数<code>exec</code>删除的操作</p> <p>解决办法如下，打开<code>PHP</code>，然后把禁用函数<code>exec</code>删除</p> <p><strong>保存之后，一定要重启PHP</strong></p></div> <p><img src="/assets/fuzqing-file-manager/question-and-answer/1.png" alt=""></p> <h2 id="服务端配置"><a href="#服务端配置" class="header-anchor">#</a> 服务端配置</h2> <p>以下操作以宝塔面板为例：</p> <ol><li>打开面板，网站，然后新建站点，输入域名，如<code>my-self-built-storage1.fuzqing.com</code>，不用选择新建数据库，此服务端代码不依赖数据库</li></ol> <p><img src="/assets/fuzqing-file-manager/self-built-storage/1.png" alt=""></p> <ol start="2"><li>打开刚才新建的站点的根目录，把宝塔默认生成的文件删了</li></ol> <p><img src="/assets/fuzqing-file-manager/self-built-storage/2.png" alt=""></p> <ol start="3"><li>把<code>fuzqing-file-manager-self-built-storage-v0.1.zip</code>压缩包上传到网站根目录，解压，再把<code>fuzqing-file-manager-self-built-storage</code>文件夹的文件全部移动到网站根目录</li></ol> <p><img src="/assets/fuzqing-file-manager/self-built-storage/3.png" alt=""></p> <ol start="4"><li>配置网站运行目录</li></ol> <p><img src="/assets/fuzqing-file-manager/self-built-storage/4.png" alt=""></p> <ol start="5"><li>配置站点伪静态规则，新增如下规则</li></ol> <div class="language- extra-class"><pre class="language-text"><code>location /{
	if (!-e $request_filename) {
	   rewrite  ^(.*)$  /index.php/$1  last;
	   break;
	}
}
location /protected-files/ {
   internal;
   #自建存储服务端的网站目录，别他喵的直接抄我的
   root   /www/wwwroot/my-self-built-storage1.fuzqing.com;
}
</code></pre></div><p><img src="/assets/fuzqing-file-manager/self-built-storage/5.png" alt=""></p> <ol start="5"><li>配置认证授权的密钥</li></ol> <p><img src="/assets/fuzqing-file-manager/self-built-storage/6.png" alt=""></p> <h2 id="插件配置项"><a href="#插件配置项" class="header-anchor">#</a> 插件配置项</h2> <p>静态资源存储策略：自建存储</p> <p>自建存储节点是一个<code>JSON</code>格式的字符串，其中<code>storage_list</code>是一个数组对象</p> <div class="custom-block danger"><p class="custom-block-title">提示</p> <p>&quot;api&quot; : &quot;http://my-self-built-storage2.fuzqing.com/api&quot;
这个所谓的<code>api</code>就是你自己自建存储的域名和端口后面加上<code>/api</code>，下边的栗子是我测试的，千万别连<code>api</code>地址都抄我的</p> <p>比如张三自建了一个存储服务端，用了<code>https://download.woshizhangsan.com</code>这个域名</p> <p>那么配置的<code>api</code>地址就是<code>https://download.woshizhangsan.com/api</code></p> <p>直接在浏览器打开这个地址就会响应<code>json</code>字符串，因为没有带着上传下载的<code>token</code></p> <p>这是正常配置成功了的响应</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;404 Not Found.&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;storage_list&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;自建存储一&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;slug_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;my_self_built_storage1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;api&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://my-self-built-storage1.fuzqing.com/api&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;access_key&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bSjE1fvyxKhlE9wfcodiGTzE4o6o6dLd&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;secret_key&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;U14$GI7qQLT3sTvnMzubyYx62QX1h9UI&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;自建存储二&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;slug_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;my_self_built_storage2&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;api&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;http://my-self-built-storage2.fuzqing.com/api&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;access_key&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ol9YFgglJEpxU75btcqpFXBBRv4D0D4g&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;secret_key&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;y6zHlXAFy5$P@PnPMyZaV3^loy*^hGEB&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/fuzqing-file-manager/self-built-storage/7.png" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/6/2021, 1:21:14 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fuzqing-file-manager/getting-started.html" class="prev">
        快速上手
      </a></span> <span class="next"><a href="/fuzqing-file-manager/theme.html">
        适配主题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.3daa5b21.js" defer></script><script src="/assets/js/2.4e835e48.js" defer></script><script src="/assets/js/14.6b41597e.js" defer></script><script src="/assets/js/3.050f3734.js" defer></script>
  </body>
</html>
